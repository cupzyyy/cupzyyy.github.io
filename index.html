<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreelancePro - Cylex Edition</title>
    <!-- Font Awesome 7.0.1 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <!-- Firebase SDK v10.11.0 MODULAR -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updatePassword } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { getDatabase, ref, set, get, child, push, update, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

        // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyCf230zCliSZ9EYLByMnmflqw8sOz328Uc",
      authDomain: "database-cupz.firebaseapp.com",
      projectId: "database-cupz",
      storageBucket: "database-cupz.firebasestorage.app",
      messagingSenderId: "343357519412",
      appId: "1:343357519412:web:dce862636c7c459e6a3c61"
    };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Export ke global scope
        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.firebaseModules = { 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            updatePassword,
            ref, set, get, child, push, update, onValue
        };
    </script>
    <style>
        /* RESET & GLOBAL */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* GLOSSY IOS EFFECT */
        .glossy-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease-out;
        }
        
        /* ANIMASI HALUS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* CONTAINER UTAMA */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* HEADER & AUTH PAGES */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .auth-box {
            width: 100%;
            max-width: 400px;
            animation: slideIn 0.6s ease-out;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #ff0080, #00ffcc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .logo p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .form-control {
            width: 100%;
            padding: 15px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #00ffcc;
            box-shadow: 0 0 0 3px rgba(0, 255, 204, 0.2);
        }
        
        /* BUTTONS */
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00ffcc, #00ccff);
            color: #000;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #00ccff, #00ffcc);
            animation: pulse 0.5s ease;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        .btn-danger:hover {
            background: linear-gradient(90deg, #ff4b2b, #ff416c);
        }
        
        /* BOTTOM NAVIGATION */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 0;
            z-index: 1000;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-around;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 15px;
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            min-width: 70px;
        }
        
        .nav-item.active {
            color: #00ffcc;
            background: rgba(0, 255, 204, 0.1);
        }
        
        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .nav-text {
            font-size: 0.8em;
            font-weight: 500;
        }
        
        /* CONTENT AREA */
        .content {
            padding: 20px;
            animation: fadeIn 0.4s ease-out;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* HOME PAGE */
        .welcome-section {
            margin-bottom: 30px;
        }
        
        .welcome-text {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .balance-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .balance-amount {
            font-size: 2.5em;
            font-weight: 800;
            margin: 10px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #00ffcc;
        }
        
        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .broadcast-box {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #00ffcc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        /* REFERRAL PAGE */
        .referral-link-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .referral-link {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            word-break: break-all;
            font-family: monospace;
        }
        
        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* WITHDRAW PAGE */
        .withdraw-form .form-group {
            margin-bottom: 15px;
        }
        
        .select-control {
            width: 100%;
            padding: 15px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 16px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 20px;
        }
        
        .select-control option {
            background: #302b63;
            color: white;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .status-success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }
        
        /* HISTORY PAGE */
        .history-list {
            margin-top: 20px;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #00ffcc;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .history-amount {
            font-size: 1.2em;
            font-weight: 700;
            color: #00ffcc;
        }
        
        /* PROFILE PAGE */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #00ffcc, #00ccff);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
        }
        
        .user-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }
        
        /* LOADING & ALERTS */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 15px;
            margin: 15px 0;
            animation: fadeIn 0.3s ease;
        }
        
        .alert-success {
            background: rgba(40, 167, 69, 0.2);
            border-left: 4px solid #28a745;
        }
        
        .alert-error {
            background: rgba(220, 53, 69, 0.2);
            border-left: 4px solid #dc3545;
        }
        
        /* UTILITY */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- AUTH PAGES -->
    <div id="authPages" class="auth-container">
        <div class="auth-box">
            <div class="logo">
                <h1><i class="fas fa-code"></i> FreelancePro</h1>
                <p>Cylex Edition â€¢ Unlimited Earnings</p>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="glossy-card">
                <h2 style="margin-bottom: 20px;">Login ke Akun</h2>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="email@contoh.com">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button onclick="login()" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <p class="text-center mt-20">
                    Belum punya akun? 
                    <a href="#" onclick="showRegister()" style="color: #00ffcc; text-decoration: none;">
                        Daftar disini
                    </a>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="glossy-card hidden">
                <h2 style="margin-bottom: 20px;">Buat Akun Baru</h2>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="email@contoh.com">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="Minimal 6 karakter">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Konfirmasi Password</label>
                    <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Ulangi password">
                </div>
                <button onclick="register()" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> Daftar Sekarang
                </button>
                <p class="text-center mt-20">
                    Sudah punya akun? 
                    <a href="#" onclick="showLogin()" style="color: #00ffcc; text-decoration: none;">
                        Login disini
                    </a>
                </p>
            </div>
        </div>
    </div>
    
    <!-- MAIN APP (Hidden until login) -->
    <div id="mainApp" class="hidden">
        <div class="container">
            <!-- Header -->
            <div class="logo mt-20">
                <h1><i class="fas fa-rocket"></i> FreelancePro</h1>
                <p>Welcome back, <span id="userEmailDisplay"></span></p>
            </div>
            
            <!-- Content Area -->
            <div class="content">
                <!-- HOME PAGE -->
                <div id="homePage" class="page active">
                    <div class="welcome-section">
                        <h1 class="welcome-text">Halo, <span id="userName"></span>! ðŸ‘‹</h1>
                        <p>Semangat hari ini! ðŸ’°</p>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-label">BALANCE ANDA</div>
                        <div class="balance-amount" id="userBalance">Rp 0</div>
                        <div class="balance-label">Update real-time</div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="refSuccess">0</div>
                            <div class="stat-label">Referral Berhasil</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="refFailed">0</div>
                            <div class="stat-label">Referral Gagal</div>
                        </div>
                    </div>
                    
                    <div class="broadcast-box">
                        <h3><i class="fas fa-bullhorn"></i> Broadcast Panduan</h3>
                        <p style="margin-top: 10px; opacity: 0.9;">
                            1. Ajak teman gabung pakai link referral<br>
                            2. Dapatkan 10% dari earning pertama mereka<br>
                            3. Minimum withdraw Rp 50,000<br>
                            4. Proses withdraw 1-3 hari kerja
                        </p>
                    </div>
                </div>
                
                <!-- REFERRAL PAGE -->
                <div id="referralPage" class="page">
                    <h2 style="margin-bottom: 20px;"><i class="fas fa-share-alt"></i> Referral System</h2>
                    
                    <div class="referral-link-box">
                        <h3>Link Referral Anda</h3>
                        <div class="referral-link" id="referralLink">
                            https://freelancepro.com/ref/loading...
                        </div>
                        <button onclick="copyReferralLink()" class="copy-btn">
                            <i class="fas fa-copy"></i> Copy Link
                        </button>
                        <p style="margin-top: 15px; font-size: 0.9em;">
                            Dapatkan 10% komisi dari setiap teman yang join!
                        </p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="refSuccess2">0</div>
                            <div class="stat-label">Referral Berhasil</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="refFailed2">0</div>
                            <div class="stat-label">Referral Gagal</div>
                        </div>
                    </div>
                    
                    <div class="broadcast-box">
                        <h3><i class="fas fa-bullhorn"></i> Cara Kerja Referral</h3>
                        <p style="margin-top: 10px; opacity: 0.9;">
                            â€¢ Bagikan link referral ke teman<br>
                            â€¢ Teman harus deposit minimal Rp 100,000<br>
                            â€¢ Komisi langsung masuk ke balance<br>
                            â€¢ Bisa withdraw kapan saja
                        </p>
                    </div>
                </div>
                
                <!-- WITHDRAW PAGE -->
                <div id="withdrawPage" class="page">
                    <h2 style="margin-bottom: 20px;"><i class="fas fa-money-bill-wave"></i> Withdraw Dana</h2>
                    
                    <div class="balance-card mb-20">
                        <div class="balance-label">SALDO TERSEDIA</div>
                        <div class="balance-amount" id="withdrawBalance">Rp 0</div>
                        <div class="balance-label">Minimum: Rp 50,000</div>
                    </div>
                    
                    <div class="withdraw-form glossy-card">
                        <div class="form-group">
                            <label><i class="fas fa-wallet"></i> Metode Withdraw</label>
                            <select id="withdrawMethod" class="select-control">
                                <option value="dana">DANA</option>
                                <option value="shopeepay">ShopeePay</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                        
                        <div id="bankFields" class="hidden">
                            <div class="form-group">
                                <label><i class="fas fa-university"></i> Nama Bank</label>
                                <input type="text" id="bankName" class="form-control" placeholder="BCA, BNI, Mandiri, dll">
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-credit-card"></i> Nomor Rekening</label>
                                <input type="text" id="accountNumber" class="form-control" placeholder="1234567890">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Nama Pemilik</label>
                            <input type="text" id="accountName" class="form-control" placeholder="Nama sesuai rekening">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-coins"></i> Jumlah Withdraw</label>
                            <input type="number" id="withdrawAmount" class="form-control" placeholder="50000" min="50000">
                        </div>
                        
                        <button onclick="submitWithdraw()" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Withdraw Sekarang!
                        </button>
                        
                        <div id="withdrawStatus" class="mt-20" style="display: none;">
                            <div class="alert">
                                <strong>Status:</strong> 
                                <span id="statusText">Pending</span>
                                <span id="statusBadge" class="status-badge status-pending">Pending</span>
                            </div>
                            <p style="margin-top: 10px; font-size: 0.9em;">
                                <i class="fas fa-info-circle"></i> Admin akan memproses dalam 1-3 hari kerja
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- HISTORY PAGE -->
                <div id="historyPage" class="page">
                    <h2 style="margin-bottom: 20px;"><i class="fas fa-history"></i> Riwayat Withdraw</h2>
                    
                    <div class="history-list" id="withdrawHistory">
                        <div class="history-item">
                            <div class="history-header">
                                <div>
                                    <strong>DANA</strong><br>
                                    <small>12 Jan 2024</small>
                                </div>
                                <div class="history-amount">Rp 100,000</div>
                            </div>
                            <div>
                                Status: <span class="status-badge status-success">Success</span>
                            </div>
                        </div>
                        
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading history...
                        </div>
                    </div>
                </div>
                
                <!-- PROFILE PAGE -->
                <div id="profilePage" class="page">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 id="profileEmail">user@email.com</h2>
                        <p>User ID: <span id="userId">loading...</span></p>
                    </div>
                    
                    <div class="user-info-grid">
                        <div class="info-card">
                            <div class="stat-label">Total Earnings</div>
                            <div class="stat-value" id="totalEarnings">Rp 0</div>
                        </div>
                        <div class="info-card">
                            <div class="stat-label">Withdraw Success</div>
                            <div class="stat-value" id="withdrawSuccess">0</div>
                        </div>
                    </div>
                    
                    <div class="glossy-card mt-20">
                        <h3 style="margin-bottom: 15px;"><i class="fas fa-key"></i> Ganti Password</h3>
                        <div class="form-group">
                            <label>Password Baru</label>
                            <input type="password" id="newPassword" class="form-control" placeholder="Minimal 6 karakter">
                        </div>
                        <div class="form-group">
                            <label>Konfirmasi Password</label>
                            <input type="password" id="confirmNewPassword" class="form-control" placeholder="Ulangi password baru">
                        </div>
                        <button onclick="changePassword()" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Update Password
                        </button>
                    </div>
                    
                    <button onclick="logout()" class="btn btn-danger mt-20" style="width: 100%;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
        
        <!-- BOTTOM NAVIGATION -->
        <div class="bottom-nav">
            <div class="nav-container">
                <a href="#" onclick="showPage('homePage')" class="nav-item active" id="navHome">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <div class="nav-text">Home</div>
                </a>
                <a href="#" onclick="showPage('referralPage')" class="nav-item" id="navReferral">
                    <div class="nav-icon"><i class="fas fa-share-alt"></i></div>
                    <div class="nav-text">Referral</div>
                </a>
                <a href="#" onclick="showPage('withdrawPage')" class="nav-item" id="navWithdraw">
                    <div class="nav-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="nav-text">Withdraw</div>
                </a>
                <a href="#" onclick="showPage('historyPage')" class="nav-item" id="navHistory">
                    <div class="nav-icon"><i class="fas fa-history"></i></div>
                    <div class="nav-text">Riwayat</div>
                </a>
                <a href="#" onclick="showPage('profilePage')" class="nav-item" id="navProfile">
                    <div class="nav-icon"><i class="fas fa-user"></i></div>
                    <div class="nav-text">Profile</div>
                </a>
            </div>
        </div>
    </div>
    
    <!-- ALERT CONTAINER -->
    <div id="alertContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 300px;"></div>

    <!-- MAIN JAVASCRIPT -->
    <script>
        // Firebase Modules
        const auth = window.firebaseAuth;
        const db = window.firebaseDatabase;
        const fb = window.firebaseModules;
        
        // DOM Elements
        let currentUser = null;
        let userData = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Setup withdraw method change
            document.getElementById('withdrawMethod').addEventListener('change', function() {
                const bankFields = document.getElementById('bankFields');
                if (this.value === 'bank') {
                    bankFields.classList.remove('hidden');
                } else {
                    bankFields.classList.add('hidden');
                }
            });
            
            // Check auth state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showMainApp();
                    loadUserData();
                } else {
                    showAuth();
                }
            });
        });
        
        // AUTH FUNCTIONS
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }
        
        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }
        
        function showAuth() {
            document.getElementById('authPages').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            showLogin();
        }
        
        function showMainApp() {
            document.getElementById('authPages').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }
        
        async function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!email || !password) {
                showAlert('Email dan password harus diisi!', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert('Password tidak cocok!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAlert('Password minimal 6 karakter!', 'error');
                return;
            }
            
            try {
                const userCredential = await fb.createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Create user data in Realtime Database
                const userRef = fb.ref(db, 'users/' + user.uid);
                await fb.set(userRef, {
                    email: email,
                    balance: 100000, // Initial balance
                    refSuccess: 0,
                    refFailed: 0,
                    totalEarnings: 0,
                    withdrawSuccess: 0,
                    createdAt: new Date().toISOString(),
                    referralCode: generateReferralCode(),
                    withdrawHistory: {}
                });
                
                showAlert('Registrasi berhasil! Balance awal Rp 100,000', 'success');
                showLogin();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showAlert('Email dan password harus diisi!', 'error');
                return;
            }
            
            try {
                await fb.signInWithEmailAndPassword(auth, email, password);
                showAlert('Login berhasil!', 'success');
            } catch (error) {
                showAlert('Login gagal: ' + error.message, 'error');
            }
        }
        
        // NAVIGATION FUNCTIONS
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Set active nav item
            document.getElementById('nav' + pageId.charAt(0).toUpperCase() + pageId.slice(1)).classList.add('active');
            
            // Load page-specific data
            switch(pageId) {
                case 'homePage':
                    updateHomeData();
                    break;
                case 'referralPage':
                    updateReferralData();
                    break;
                case 'withdrawPage':
                    updateWithdrawPage();
                    break;
                case 'historyPage':
                    loadWithdrawHistory();
                    break;
                case 'profilePage':
                    updateProfileData();
                    break;
            }
        }
        
        // USER DATA FUNCTIONS
        async function loadUserData() {
            if (!currentUser) return;
            
            const userRef = fb.ref(db, 'users/' + currentUser.uid);
            fb.onValue(userRef, (snapshot) => {
                userData = snapshot.val();
                if (userData) {
                    updateUI();
                }
            });
        }
        
        function updateUI() {
            if (!currentUser || !userData) return;
            
            // Basic info
            document.getElementById('userEmailDisplay').textContent = currentUser.email;
            document.getElementById('userName').textContent = currentUser.email.split('@')[0];
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('userId').textContent = currentUser.uid.substring(0, 8);
            
            // Balance
            document.getElementById('userBalance').textContent = formatCurrency(userData.balance || 0);
            document.getElementById('withdrawBalance').textContent = formatCurrency(userData.balance || 0);
            
            // Stats
            document.getElementById('refSuccess').textContent = userData.refSuccess || 0;
            document.getElementById('refFailed').textContent = userData.refFailed || 0;
            document.getElementById('refSuccess2').textContent = userData.refSuccess || 0;
            document.getElementById('refFailed2').textContent = userData.refFailed || 0;
            document.getElementById('totalEarnings').textContent = formatCurrency(userData.totalEarnings || 0);
            document.getElementById('withdrawSuccess').textContent = userData.withdrawSuccess || 0;
            
            // Referral link
            const refLink = `https://freelancepro.com/ref/${userData.referralCode || currentUser.uid.substring(0, 8)}`;
            document.getElementById('referralLink').textContent = refLink;
        }
        
        function updateHomeData() {
            updateUI();
        }
        
        function updateReferralData() {
            updateUI();
        }
        
        function updateWithdrawPage() {
            updateUI();
        }
        
        function updateProfileData() {
            updateUI();
        }
        
        // WITHDRAW FUNCTIONS
        async function submitWithdraw() {
            if (!currentUser || !userData) return;
            
            const method = document.getElementById('withdrawMethod').value;
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const accountName = document.getElementById('accountName').value;
            
            if (!accountName) {
                showAlert('Nama pemilik harus diisi!', 'error');
                return;
            }
            
            if (!amount || amount < 50000) {
                showAlert('Minimum withdraw Rp 50,000!', 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showAlert('Balance tidak mencukupi!', 'error');
                return;
            }
            
            let bankName = '';
            let accountNumber = '';
            
            if (method === 'bank') {
                bankName = document.getElementById('bankName').value;
                accountNumber = document.getElementById('accountNumber').value;
                
                if (!bankName || !accountNumber) {
                    showAlert('Data bank harus lengkap!', 'error');
                    return;
                }
            }
            
            // Create withdraw request
            const withdrawId = 'w' + Date.now();
            const withdrawRef = fb.ref(db, `withdraws/${currentUser.uid}/${withdrawId}`);
            
            const withdrawData = {
                id: withdrawId,
                userId: currentUser.uid,
                method: method,
                amount: amount,
                accountName: accountName,
                bankName: bankName,
                accountNumber: accountNumber,
                status: 'pending',
                createdAt: new Date().toISOString(),
                processedAt: null
            };
            
            try {
                // Update user balance
                const newBalance = userData.balance - amount;
                const userRef = fb.ref(db, 'users/' + currentUser.uid);
                
                await fb.update(userRef, {
                    balance: newBalance
                });
                
                // Save withdraw request
                await fb.set(withdrawRef, withdrawData);
                
                // Show status
                document.getElementById('withdrawStatus').style.display = 'block';
                document.getElementById('statusText').textContent = 'Pending - Menunggu konfirmasi admin';
                
                // Reset form
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('accountName').value = '';
                
                if (method === 'bank') {
                    document.getElementById('bankName').value = '';
                    document.getElementById('accountNumber').value = '';
                }
                
                showAlert('Withdraw request berhasil dikirim! Admin akan memproses dalam 1-3 hari.', 'success');
                
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        async function loadWithdrawHistory() {
            if (!currentUser) return;
            
            const historyRef = fb.ref(db, `withdraws/${currentUser.uid}`);
            fb.onValue(historyRef, (snapshot) => {
                const historyList = document.getElementById('withdrawHistory');
                historyList.innerHTML = '';
                
                const data = snapshot.val();
                if (!data) {
                    historyList.innerHTML = '<div class="text-center" style="padding: 40px;">Belum ada riwayat withdraw</div>';
                    return;
                }
                
                Object.values(data).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(withdraw => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    
                    const date = new Date(withdraw.createdAt).toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                    
                    const methodDisplay = {
                        'dana': 'DANA',
                        'shopeepay': 'ShopeePay',
                        'bank': 'Bank Transfer'
                    }[withdraw.method] || withdraw.method;
                    
                    const statusClass = withdraw.status === 'success' ? 'status-success' : 'status-pending';
                    const statusText = withdraw.status === 'success' ? 'Success' : 'Pending';
                    
                    item.innerHTML = `
                        <div class="history-header">
                            <div>
                                <strong>${methodDisplay}</strong><br>
                                <small>${date}</small>
                            </div>
                            <div class="history-amount">${formatCurrency(withdraw.amount)}</div>
                        </div>
                        <div>
                            Status: <span class="status-badge ${statusClass}">${statusText}</span>
                            ${withdraw.bankName ? `<br>Bank: ${withdraw.bankName} - ${withdraw.accountNumber}` : ''}
                        </div>
                    `;
                    
                    historyList.appendChild(item);
                });
            });
        }
        
        // PROFILE FUNCTIONS
        async function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (!newPassword || !confirmPassword) {
                showAlert('Password harus diisi!', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('Password tidak cocok!', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showAlert('Password minimal 6 karakter!', 'error');
                return;
            }
            
            try {
                await fb.updatePassword(currentUser, newPassword);
                showAlert('Password berhasil diubah!', 'success');
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmNewPassword').value = '';
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        async function logout() {
            try {
                await fb.signOut(auth);
                showAlert('Logout berhasil!', 'success');
            } catch (error) {
                showAlert('Logout error: ' + error.message, 'error');
            }
        }
        
        // UTILITY FUNCTIONS
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showAlert('Link referral berhasil disalin!', 'success');
            });
        }
        
        function formatCurrency(amount) {
            return 'Rp ' + amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}" 
                       style="margin-right: 10px; font-size: 1.2em;"></i>
                    <div>${message}</div>
                </div>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 300);
            }, 5000);
        }
        
        // INITIALIZE DEFAULT DATA
        function initDefaultData() {
            // This would be called once when setting up the database
            console.log('App initialized with Firebase v10.11.0');
        }
        
        // Start the app
        initDefaultData();
    </script>
</body>
</html>