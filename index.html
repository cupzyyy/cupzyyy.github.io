<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>REFERRAL PREMIUM PRO | ELITE EARNINGS</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Font Awesome & Google Font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ========== VARIABLES GLOSSY ELITE ========== */
    :root {
      /* PALETTE PREMIUM */
      --primary-gradient: linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%);
      --secondary-gradient: linear-gradient(135deg, #00D4FF 0%, #0077FF 100%);
      --gold-gradient: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      --success-gradient: linear-gradient(135deg, #00FF7F 0%, #00CC66 100%);
      --danger-gradient: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
      --purple-gradient: linear-gradient(135deg, #9D50BB 0%, #6A11CB 100%);
      
      /* GLASS EFFECT COLORS */
      --glass-white: rgba(255, 255, 255, 0.12);
      --glass-white-border: rgba(255, 255, 255, 0.25);
      --glass-dark: rgba(0, 0, 0, 0.2);
      --glass-purple: rgba(138, 43, 226, 0.15);
      --glass-blue: rgba(0, 119, 255, 0.15);
      
      /* TEXT COLORS */
      --text-primary: #FFFFFF;
      --text-secondary: rgba(255, 255, 255, 0.85);
      --text-muted: rgba(255, 255, 255, 0.6);
      --text-gold: #FFD700;
      --text-purple: #DDA0DD;
      --text-blue: #00D4FF;
      
      /* SHADOWS */
      --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
      --shadow-medium: 0 15px 40px rgba(0, 0, 0, 0.2);
      --shadow-hard: 0 25px 60px rgba(0, 0, 0, 0.3);
      --shadow-glow: 0 0 40px rgba(138, 43, 226, 0.5);
      --shadow-glow-blue: 0 0 40px rgba(0, 119, 255, 0.5);
      --shadow-glow-gold: 0 0 40px rgba(255, 215, 0, 0.5);
    }

    /* ========== GLOBAL RESET ========== */
    * {
      box-sizing: border-box;
      font-family: 'Inter', 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* ANIMATED BACKGROUND EFFECTS */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 119, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
      z-index: -1;
      animation: bgPulse 15s ease-in-out infinite alternate;
    }

    @keyframes bgPulse {
      0% { opacity: 0.3; transform: scale(1); }
      100% { opacity: 0.7; transform: scale(1.1); }
    }

    /* GLASS MORPHISM CARD BASE */
    .glass-card {
      background: var(--glass-white);
      backdrop-filter: blur(25px) saturate(180%);
      -webkit-backdrop-filter: blur(25px) saturate(180%);
      border-radius: 28px;
      border: 1px solid var(--glass-white-border);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, 
        transparent 30%, 
        rgba(255, 255, 255, 0.05) 50%, 
        transparent 70%);
      transform: rotate(45deg);
      transition: all 0.6s ease;
      opacity: 0;
    }

    .glass-card:hover::before {
      animation: shine 1.5s ease;
    }

    @keyframes shine {
      0% { opacity: 0; transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      50% { opacity: 1; }
      100% { opacity: 0; transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .glass-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-medium), var(--shadow-glow);
      border-color: rgba(255, 255, 255, 0.4);
    }

    /* ========== LOGIN PAGE ELITE ========== */
    .login-container {
      display: block;
      width: 100%;
      max-width: 420px;
      animation: fadeInUp 0.8s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .login-card {
      padding: 42px 36px;
      text-align: center;
      position: relative;
    }

    /* LOGO HEADER GLOSSY */
    .logo-header {
      margin-bottom: 32px;
      position: relative;
    }

    .logo-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: var(--primary-gradient);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      box-shadow: var(--shadow-glow);
      position: relative;
      overflow: hidden;
    }

    .logo-icon::after {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: linear-gradient(45deg, 
        rgba(255,255,255,0.2) 0%, 
        transparent 30%, 
        transparent 70%, 
        rgba(255,255,255,0.2) 100%);
      transform: rotate(45deg);
      animation: rotateShine 8s linear infinite;
    }

    @keyframes rotateShine {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo-header h1 {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, #FFFFFF 0%, #DDA0DD 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      text-shadow: 0 2px 20px rgba(138, 43, 226, 0.3);
    }

    .logo-header p {
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    /* INPUT FIELDS GLOSSY */
    .input-group {
      margin-bottom: 22px;
      text-align: left;
    }

    .input-label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .glossy-input {
      width: 100%;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 400;
      outline: none;
      transition: all 0.3s ease;
      position: relative;
    }

    .glossy-input:focus {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(138, 43, 226, 0.8);
      box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2), 
                  inset 0 0 20px rgba(255, 255, 255, 0.05);
      transform: translateY(-2px);
    }

    .glossy-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    /* BUTTONS PREMIUM */
    .btn-premium {
      width: 100%;
      padding: 18px 24px;
      border: none;
      border-radius: 18px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      margin-top: 10px;
      letter-spacing: 0.5px;
    }

    .btn-premium::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.7s ease;
    }

    .btn-premium:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--primary-gradient);
      box-shadow: var(--shadow-medium), var(--shadow-glow);
    }

    .btn-primary:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 50px rgba(138, 43, 226, 0.4), var(--shadow-glow);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #2C3E50 0%, #4A6491 100%);
      box-shadow: var(--shadow-soft);
    }

    .btn-secondary:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .btn-gold {
      background: var(--gold-gradient);
      box-shadow: var(--shadow-medium), var(--shadow-glow-gold);
    }

    .btn-gold:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 50px rgba(255, 215, 0, 0.3), var(--shadow-glow-gold);
    }

    .btn-blue {
      background: var(--secondary-gradient);
      box-shadow: var(--shadow-medium), var(--shadow-glow-blue);
    }

    .btn-blue:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 50px rgba(0, 119, 255, 0.3), var(--shadow-glow-blue);
    }

    /* FORM TOGGLE */
    .form-toggle {
      text-align: center;
      margin-top: 28px;
      color: var(--text-muted);
      font-size: 14px;
    }

    .form-toggle a {
      color: var(--text-blue);
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
      position: relative;
      padding-bottom: 2px;
    }

    .form-toggle a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--text-blue);
      transition: width 0.3s ease;
    }

    .form-toggle a:hover::after {
      width: 100%;
    }

    /* ERROR/SUCCESS MESSAGES */
    .glossy-alert {
      padding: 16px 20px;
      border-radius: 16px;
      margin: 20px 0;
      font-size: 14px;
      display: none;
      animation: slideIn 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid;
    }

    .alert-error {
      background: rgba(255, 65, 108, 0.15);
      border-color: rgba(255, 65, 108, 0.3);
      color: #FFB6C1;
    }

    .alert-success {
      background: rgba(0, 255, 127, 0.15);
      border-color: rgba(0, 255, 127, 0.3);
      color: #90EE90;
    }

    /* ========== MAIN APP CONTAINER ========== */
    .app-container {
      display: none;
      width: 100%;
      max-width: 440px;
      margin: 0 auto;
      padding-bottom: 90px;
    }

    /* USER INFO BAR GLOSSY */
    .user-info-bar {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--glass-white);
      backdrop-filter: blur(25px);
      border-radius: 22px;
      margin-bottom: 24px;
      cursor: pointer;
      border: 1px solid var(--glass-white-border);
      transition: all 0.3s ease;
    }

    .user-info-bar:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }

    .user-avatar-elite {
      width: 56px;
      height: 56px;
      background: var(--primary-gradient);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 800;
      color: white;
      box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3);
      position: relative;
      overflow: hidden;
    }

    .user-avatar-elite::after {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg);
    }

    .user-details-elite {
      flex: 1;
    }

    .user-email-elite {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .user-role-elite {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-blue);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: inline-block;
      padding: 4px 12px;
      background: rgba(0, 119, 255, 0.1);
      border-radius: 20px;
      border: 1px solid rgba(0, 119, 255, 0.2);
    }

    /* ========== HOME PAGE ELITE ========== */
    .home-grid-elite {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      margin-bottom: 28px;
    }

    .stat-card-elite {
      padding: 24px;
      border-radius: 22px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .stat-card-elite::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(5px);
      z-index: 1;
    }

    .stat-content {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 800;
      margin: 8px 0;
      background: linear-gradient(135deg, #FFFFFF 0%, #DDA0DD 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-title {
      font-size: 13px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 500;
    }

    .stat-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    /* BALANCE CARD SPECIAL */
    .balance-card-elite {
      grid-column: span 2;
      background: linear-gradient(135deg, 
        rgba(138, 43, 226, 0.15) 0%, 
        rgba(75, 0, 130, 0.1) 100%);
      border: 1px solid rgba(138, 43, 226, 0.3);
    }

    .balance-card-elite:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 60px rgba(138, 43, 226, 0.2), var(--shadow-glow);
    }

    /* REWARD CARD SPECIAL */
    .reward-card-elite {
      grid-column: span 2;
      background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.15) 0%, 
        rgba(255, 165, 0, 0.1) 100%);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    .reward-card-elite:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 60px rgba(255, 215, 0, 0.2), var(--shadow-glow-gold);
    }

    /* ========== GUIDE BOX ELITE ========== */
    .guide-box-elite {
      padding: 28px;
      border-radius: 24px;
      background: linear-gradient(135deg, 
        rgba(0, 0, 0, 0.3) 0%, 
        rgba(26, 26, 46, 0.4) 100%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 24px;
      position: relative;
      overflow: hidden;
    }

    .guide-box-elite::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(138, 43, 226, 0.5), 
        rgba(0, 119, 255, 0.5), 
        transparent);
    }

    .guide-title-elite {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 22px;
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .guide-title-elite i {
      color: var(--text-blue);
      font-size: 20px;
    }

    .guide-list-elite {
      list-style: none;
      padding: 0;
    }

    .guide-list-elite li {
      padding: 10px 0;
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
      position: relative;
      padding-left: 28px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .guide-list-elite li:last-child {
      border-bottom: none;
    }

    .guide-list-elite li::before {
      content: 'âœ“';
      position: absolute;
      left: 0;
      top: 10px;
      width: 18px;
      height: 18px;
      background: rgba(0, 255, 127, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #00FF7F;
      font-weight: bold;
    }

    /* ========== REFERRAL PAGE ELITE ========== */
    .referral-card-elite {
      padding: 32px;
      border-radius: 26px;
      background: linear-gradient(135deg, 
        rgba(157, 80, 187, 0.2) 0%, 
        rgba(106, 17, 203, 0.15) 100%);
      border: 1px solid rgba(157, 80, 187, 0.3);
      margin-bottom: 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .referral-code-elite {
      background: rgba(0, 0, 0, 0.25);
      border: 2px solid;
      border-image: linear-gradient(45deg, #8A2BE2, #4B0082) 1;
      border-radius: 18px;
      padding: 20px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 3px;
      color: var(--text-gold);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .referral-code-elite:hover {
      background: rgba(138, 43, 226, 0.15);
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(138, 43, 226, 0.3);
    }

    .referral-stats-elite {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 25px 0;
    }

    .referral-stat-elite {
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .referral-stat-value {
      font-size: 28px;
      font-weight: 800;
      color: white;
      margin: 10px 0;
    }

    .referral-stat-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ========== WITHDRAWAL PAGE ELITE ========== */
    .withdrawal-options-elite {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin: 24px 0;
    }

    .wallet-option-elite {
      padding: 18px 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid transparent;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .wallet-option-elite:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-5px);
    }

    .wallet-option-elite.active {
      border-color: var(--text-blue);
      background: rgba(0, 119, 255, 0.15);
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 119, 255, 0.2);
    }

    .wallet-icon-elite {
      font-size: 28px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, currentColor 0%, #FFFFFF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .wallet-name-elite {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* WITHDRAWAL HISTORY ELITE */
    .history-item-elite {
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 18px;
      margin-bottom: 12px;
      border-left: 4px solid;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .history-item-elite:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-3px);
    }

    .history-item-elite::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, currentColor, transparent);
    }

    /* ========== PROFILE PAGE ELITE ========== */
    .profile-section-elite {
      padding: 24px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 22px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .data-row-elite {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .data-row-elite:last-child {
      border-bottom: none;
    }

    .data-label-elite {
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 500;
    }

    .data-value-elite {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 15px;
      text-align: right;
    }

    .user-id-elite {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: var(--text-blue);
      background: rgba(0, 119, 255, 0.1);
      padding: 6px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0, 119, 255, 0.2);
    }

    /* ========== BOTTOM NAV ELITE ========== */
    .bottom-nav-elite {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 40px);
      max-width: 440px;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(30px) saturate(180%);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 16px;
      display: flex;
      justify-content: space-between;
      z-index: 1000;
      box-shadow: var(--shadow-medium);
    }

    .nav-item-elite {
      flex: 1;
      text-align: center;
      padding: 12px 0;
      cursor: pointer;
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }

    .nav-item-elite.active {
      background: rgba(138, 43, 226, 0.2);
      transform: translateY(-5px);
    }

    .nav-item-elite.active .nav-icon-elite {
      color: var(--text-purple);
      transform: scale(1.2);
    }

    .nav-icon-elite {
      font-size: 22px;
      margin-bottom: 6px;
      color: var(--text-muted);
      transition: all 0.3s ease;
    }

    .nav-label-elite {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ========== MODALS ELITE ========== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(15px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content-elite {
      background: linear-gradient(135deg, 
        rgba(26, 26, 46, 0.95) 0%, 
        rgba(10, 10, 15, 0.98) 100%);
      border-radius: 32px;
      padding: 36px;
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-hard), 
                  0 0 100px rgba(138, 43, 226, 0.2);
      animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* ========== NOTIFICATION ELITE ========== */
    .notification-elite {
      position: fixed;
      top: 30px;
      right: 30px;
      padding: 18px 24px;
      border-radius: 18px;
      background: rgba(26, 26, 46, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      z-index: 10000;
      box-shadow: var(--shadow-medium);
      animation: slideInRight 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      
      .login-card, 
      .glass-card {
        padding: 30px 24px;
      }
      
      .home-grid-elite {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .stat-card-elite,
      .balance-card-elite,
      .reward-card-elite {
        grid-column: span 1;
      }
      
      .withdrawal-options-elite {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .bottom-nav-elite {
        width: calc(100% - 30px);
        padding: 12px;
        bottom: 15px;
      }
      
      .modal-content-elite {
        padding: 24px;
      }
    }

    /* ========== SCROLLBAR STYLING ========== */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-gradient);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #9D50BB 0%, #6A11CB 100%);
    }

    /* ========== FLOATING PARTICLES ========== */
    .floating-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      pointer-events: none;
      z-index: -1;
      animation: float 20s infinite linear;
    }

    @keyframes float {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(100px);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <!-- FLOATING PARTICLES -->
  <div id="particles"></div>

  <!-- LOGIN PAGE -->
  <div id="loginPage" class="login-container">
    <div class="glass-card login-card">
      <div class="logo-header">
        <div class="logo-icon">
          <i class="fas fa-gem"></i>
        </div>
        <h1>REFERRAL ELITE</h1>
        <p>Maximize Your Earnings with Premium Referrals</p>
      </div>

      <div id="loginForm">
        <div class="input-group">
          <label class="input-label">EMAIL</label>
          <input type="email" id="loginEmail" class="glossy-input" placeholder="your@email.com">
        </div>

        <div class="input-group">
          <label class="input-label">PASSWORD</label>
          <input type="password" id="loginPassword" class="glossy-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>

        <div class="input-group">
          <label class="input-label">REFERRAL CODE (OPTIONAL)</label>
          <input type="text" id="referralCode" class="glossy-input" placeholder="Enter friend's code">
        </div>

        <div id="loginError" class="glossy-alert alert-error"></div>

        <button class="btn-premium btn-primary" onclick="login()" id="loginBtn">
          <i class="fas fa-lock-open"></i>
          <span id="loginBtnText">ACCESS PREMIUM</span>
        </button>

        <div class="form-toggle">
          New to Elite? <a onclick="showRegister()">Create Account</a>
        </div>
      </div>

      <div id="registerForm" style="display: none;">
        <div class="input-group">
          <label class="input-label">EMAIL</label>
          <input type="email" id="registerEmail" class="glossy-input" placeholder="your@email.com">
        </div>

        <div class="input-group">
          <label class="input-label">PASSWORD</label>
          <input type="password" id="registerPassword" class="glossy-input" placeholder="Minimum 6 characters">
        </div>

        <div class="input-group">
          <label class="input-label">CONFIRM PASSWORD</label>
          <input type="password" id="registerConfirm" class="glossy-input" placeholder="Repeat password">
        </div>

        <div class="input-group">
          <label class="input-label">REFERRAL CODE (OPTIONAL)</label>
          <input type="text" id="registerReferral" class="glossy-input" placeholder="Enter friend's code">
        </div>

        <div id="registerError" class="glossy-alert alert-error"></div>

        <button class="btn-premium btn-primary" onclick="register()" id="registerBtn">
          <i class="fas fa-user-plus"></i>
          <span id="registerBtnText">JOIN ELITE</span>
        </button>

        <div class="form-toggle">
          Already have an account? <a onclick="showLogin()">Sign In</a>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="appContainer" class="app-container">
    <!-- USER INFO BAR -->
    <div class="user-info-bar" onclick="showAppPage('profilePage')">
      <div class="user-avatar-elite" id="userAvatar">U</div>
      <div class="user-details-elite">
        <div class="user-email-elite" id="userEmail">user@email.com</div>
        <div class="user-role-elite" id="userRole">ELITE MEMBER</div>
      </div>
      <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
    </div>

    <!-- HOME PAGE -->
    <div id="homePage" class="glass-card" style="padding: 32px;">
      <div class="logo-header" style="margin-bottom: 32px;">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 24px;">
          <i class="fas fa-chart-line"></i>
        </div>
        <h1 id="welcomeText" style="font-size: 24px;">WELCOME, USER!</h1>
        <p>Real-time Earnings Dashboard</p>
      </div>

      <!-- GRID STATS -->
      <div class="home-grid-elite">
        <!-- BALANCE CARD -->
        <div class="stat-card-elite balance-card-elite" onclick="showAppPage('withdrawalPage')">
          <div class="stat-content">
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="stat-number" id="userBalance">Rp0</div>
            <div class="stat-title">AVAILABLE BALANCE</div>
            <div class="stat-hint">
              <i class="fas fa-arrow-right"></i> Tap to withdraw
            </div>
          </div>
        </div>

        <!-- SUCCESS REFERRALS -->
        <div class="stat-card-elite" style="background: rgba(0, 255, 127, 0.1); border: 1px solid rgba(0, 255, 127, 0.2);">
          <div class="stat-content">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-number" id="successReferrals">0</div>
            <div class="stat-title">SUCCESSFUL REFERRALS</div>
          </div>
        </div>

        <!-- FAILED REFERRALS -->
        <div class="stat-card-elite" style="background: rgba(255, 65, 108, 0.1); border: 1px solid rgba(255, 65, 108, 0.2);">
          <div class="stat-content">
            <div class="stat-icon">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-number" id="failedReferrals">0</div>
            <div class="stat-title">FAILED REFERRALS</div>
          </div>
        </div>

        <!-- TODAY'S REWARD -->
        <div class="stat-card-elite reward-card-elite" onclick="showAppPage('referralPage')">
          <div class="stat-content">
            <div class="stat-icon">
              <i class="fas fa-gift"></i>
            </div>
            <div class="stat-number" id="todayReward">Rp0</div>
            <div class="stat-title">TODAY'S REWARD</div>
            <div class="stat-hint">
              <i class="fas fa-bolt"></i> Rp350 per referral
            </div>
          </div>
        </div>
      </div>

      <!-- GUIDE BOX -->
      <div class="guide-box-elite">
        <div class="guide-title-elite">
          <i class="fas fa-crown"></i> Elite Referral Guide
        </div>
        <ul class="guide-list-elite">
          <li><strong>Share your referral code</strong> with friends and networks</li>
          <li><strong>Friends register/login</strong> using your unique code</li>
          <li><strong>Earn Rp350 instantly</strong> for each successful referral</li>
          <li><strong>Friends receive Rp150</strong> as welcome bonus</li>
          <li><strong>Minimum withdrawal</strong> Rp10,000 via multiple methods</li>
          <li><strong>Processing time</strong> within 24 hours after approval</li>
          <li><strong>Check history</strong> for withdrawal status updates</li>
        </ul>
      </div>
    </div>

    <!-- REFERRAL PAGE -->
    <div id="referralPage" class="glass-card" style="display: none; padding: 32px;">
      <div class="logo-header" style="margin-bottom: 28px;">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 24px;">
          <i class="fas fa-users"></i>
        </div>
        <h1>ELITE REFERRAL PROGRAM</h1>
        <p>Earn Rp350 for every successful referral!</p>
      </div>

      <div class="referral-card-elite">
        <div style="margin-bottom: 20px;">
          <i class="fas fa-gem fa-2x" style="color: var(--text-gold);"></i>
        </div>
        <h3 style="color: white; margin-bottom: 15px; font-weight: 700;">YOUR REFERRAL CODE</h3>
        <div class="referral-code-elite" onclick="copyReferralCode()" id="userReferralCode">
          LOADING...
        </div>
        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 20px;">
          Click the code above to copy
        </div>

        <div class="referral-stats-elite">
          <div class="referral-stat-elite">
            <div class="referral-stat-value" id="totalReferralsPage">0</div>
            <div class="referral-stat-label">Successful Referrals</div>
          </div>
          <div class="referral-stat-elite">
            <div class="referral-stat-value" id="failedReferralsPage">0</div>
            <div class="referral-stat-label">Failed Referrals</div>
          </div>
        </div>

        <div style="background: rgba(255, 215, 0, 0.1); border-radius: 18px; padding: 20px; margin-top: 20px; border: 1px solid rgba(255, 215, 0, 0.2);">
          <h4 style="color: var(--text-gold); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-coins"></i> Referral Rates
          </h4>
          <div style="color: var(--text-secondary); font-size: 14px; text-align: left;">
            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
              <span><strong>For You:</strong></span>
              <span style="color: #00FF7F; font-weight: 700;">Rp350 / referral</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 10px 0;">
              <span><strong>For Friend:</strong></span>
              <span style="color: var(--text-purple); font-weight: 700;">Rp150 / referral</span>
            </div>
          </div>
        </div>
      </div>

      <button class="btn-premium btn-purple" onclick="shareReferral()" style="margin-bottom: 24px;">
        <i class="fas fa-share-alt"></i>
        SHARE REFERRAL CODE
      </button>

      <div class="guide-box-elite">
        <div class="guide-title-elite">
          <i class="fas fa-lightbulb"></i> Elite Sharing Tips
        </div>
        <ul class="guide-list-elite">
          <li>ðŸ“± <strong>Share in WhatsApp Groups</strong> for maximum reach</li>
          <li>ðŸ“¸ <strong>Create Instagram Stories</strong> with your referral code</li>
          <li>ðŸ’¬ <strong>Direct message friends</strong> with personalized invites</li>
          <li>ðŸŽ¥ <strong>Make short videos</strong> explaining the earning potential</li>
          <li>ðŸ“¢ <strong>Update social media status</strong> with your referral link</li>
        </ul>
      </div>
    </div>

    <!-- WITHDRAWAL PAGE -->
    <div id="withdrawalPage" class="glass-card" style="display: none; padding: 32px;">
      <div class="logo-header" style="margin-bottom: 28px;">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 24px;">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <h1>ELITE WITHDRAWAL</h1>
        <p>Withdraw your earnings instantly</p>
      </div>

      <div style="text-align: center; margin-bottom: 28px;">
        <div style="font-size: 14px; color: var(--text-muted); letter-spacing: 1px;">TOTAL AVAILABLE BALANCE</div>
        <div style="font-size: 42px; font-weight: 900; color: var(--text-gold); margin: 15px 0;" id="withdrawalBalance">
          Rp0
        </div>
      </div>

      <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 18px; padding: 18px; margin-bottom: 24px; text-align: center;">
        <i class="fas fa-info-circle" style="color: var(--text-gold); margin-right: 8px;"></i>
        Minimum withdrawal: <strong style="color: var(--text-gold);">Rp10,000</strong>
      </div>

      <div class="input-group" style="margin-bottom: 24px;">
        <label class="input-label">SELECT WITHDRAWAL METHOD</label>
        <div class="withdrawal-options-elite">
          <div class="wallet-option-elite" onclick="selectWallet('dana')" id="walletDana">
            <div class="wallet-icon-elite" style="color: #00D4FF;"><i class="fas fa-money-bill-wave"></i></div>
            <div class="wallet-name-elite">DANA</div>
          </div>
          <div class="wallet-option-elite" onclick="selectWallet('ovo')" id="walletOvo">
            <div class="wallet-icon-elite" style="color: #4F46E5;"><i class="fas fa-bolt"></i></div>
            <div class="wallet-name-elite">OVO</div>
          </div>
          <div class="wallet-option-elite" onclick="selectWallet('shopee')" id="walletShopee">
            <div class="wallet-icon-elite" style="color: #FF5722;"><i class="fas fa-shopping-bag"></i></div>
            <div class="wallet-name-elite">SHOPEE PAY</div>
          </div>
          <div class="wallet-option-elite" onclick="selectWallet('bank')" id="walletBank">
            <div class="wallet-icon-elite" style="color: #FFD700;"><i class="fas fa-university"></i></div>
            <div class="wallet-name-elite">BANK</div>
          </div>
        </div>
      </div>

      <!-- Wallet forms would go here... -->

      <div style="margin-top: 32px;">
        <h3 style="color: white; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-history"></i> Withdrawal History
        </h3>
        <div id="withdrawalHistory">
          <div style="text-align: center; color: var(--text-muted); padding: 40px;">
            <i class="fas fa-receipt fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i><br>
            No withdrawal history yet
          </div>
        </div>
      </div>
    </div>

    <!-- PROFILE PAGE -->
    <div id="profilePage" class="glass-card" style="display: none; padding: 32px;">
      <div class="logo-header" style="margin-bottom: 28px;">
        <div class="logo-icon" style="width: 60px; height: 60px; font-size: 24px;">
          <i class="fas fa-user-circle"></i>
        </div>
        <h1>ELITE PROFILE</h1>
        <p>Manage your account and settings</p>
      </div>

      <div class="profile-section-elite">
        <div class="guide-title-elite" style="margin-bottom: 20px;">
          <i class="fas fa-id-card"></i> Account Information
        </div>
        <div id="accountInfo">
          <div class="data-row-elite">
            <span class="data-label-elite">Email</span>
            <span class="data-value-elite" id="profileEmail">-</span>
          </div>
          <div class="data-row-elite">
            <span class="data-label-elite">User ID</span>
            <div style="display: flex; align-items: center; gap: 10px;">
              <span class="data-value-elite user-id-elite" id="profileUserId">-</span>
              <button class="btn-premium btn-secondary" onclick="copyToClipboard('profileUserId')" style="padding: 8px 16px; font-size: 12px;">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
          <div class="data-row-elite">
            <span class="data-label-elite">Membership</span>
            <span class="data-value-elite" style="color: var(--text-purple); font-weight: 700;" id="profileRole">ELITE</span>
          </div>
        </div>
      </div>

      <div class="profile-section-elite">
        <div class="guide-title-elite" style="margin-bottom: 20px;">
          <i class="fas fa-chart-bar"></i> Referral Statistics
        </div>
        <div>
          <div class="data-row-elite">
            <span class="data-label-elite">Successful Referrals</span>
            <span class="data-value-elite" id="profileReferralCount">0</span>
          </div>
          <div class="data-row-elite">
            <span class="data-label-elite">Failed Referrals</span>
            <span class="data-value-elite" id="profileFailedReferrals">0</span>
          </div>
          <div class="data-row-elite">
            <span class="data-label-elite">Total Earnings</span>
            <span class="data-value-elite" style="color: var(--text-gold); font-weight: 700;" id="profileTotalEarnings">Rp0</span>
          </div>
          <div class="data-row-elite">
            <span class="data-label-elite">Current Balance</span>
            <span class="data-value-elite" style="color: #00FF7F; font-weight: 700;" id="profileBalance">Rp0</span>
          </div>
        </div>
      </div>

      <button class="btn-premium" style="background: var(--danger-gradient); margin-top: 32px;" onclick="confirmLogout()">
        <i class="fas fa-sign-out-alt"></i>
        LOGOUT ACCOUNT
      </button>

      <div style="text-align: center; margin-top: 24px; color: var(--text-muted); font-size: 11px;">
        <i class="fas fa-shield-alt"></i> Secured by Firebase Real-time Database
      </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="bottom-nav-elite">
      <div class="nav-item-elite active" onclick="showAppPage('homePage')">
        <div class="nav-icon-elite"><i class="fas fa-home"></i></div>
        <div class="nav-label-elite">HOME</div>
      </div>
      <div class="nav-item-elite" onclick="showAppPage('referralPage')">
        <div class="nav-icon-elite"><i class="fas fa-users"></i></div>
        <div class="nav-label-elite">REFERRAL</div>
      </div>
      <div class="nav-item-elite" onclick="showAppPage('withdrawalPage')">
        <div class="nav-icon-elite"><i class="fas fa-wallet"></i></div>
        <div class="nav-label-elite">WITHDRAW</div>
      </div>
      <div class="nav-item-elite" onclick="showAppPage('profilePage')">
        <div class="nav-icon-elite"><i class="fas fa-user"></i></div>
        <div class="nav-label-elite">PROFILE</div>
      </div>
    </div>
  </div>

  <!-- JavaScript would continue here... -->

  <script>
    // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyCf230zCliSZ9EYLByMnmflqw8sOz328Uc",
      authDomain: "database-cupz.firebaseapp.com",
      projectId: "database-cupz",
      storageBucket: "database-cupz.firebasestorage.app",
      messagingSenderId: "343357519412",
      appId: "1:343357519412:web:dce862636c7c459e6a3c61"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // ========== STATE VARIABLES ==========
    let currentUser = null;
    let userData = {};
    let userBalance = 0;
    let userReferralCode = '';
    let referralCount = 0;
    let failedReferrals = 0;
    let todayReward = 0;
    let selectedWallet = null;
    let realTimeListener = null;
    
    // ========== UTILITY FUNCTIONS ==========
    function formatRupiah(amount) {
      if (!amount) return 'Rp0';
      return 'Rp' + amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }
    
    function showEliteNotification(type, message, icon = null) {
      const notification = document.createElement('div');
      notification.className = 'notification-elite';
      
      if (!icon) {
        icon = type === 'success' ? 'fa-check-circle' :
               type === 'error' ? 'fa-exclamation-circle' :
               type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
      }
      
      const color = type === 'success' ? '#00FF7F' :
                   type === 'error' ? '#FF416C' :
                   type === 'warning' ? '#FFD700' : '#00D4FF';
      
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 15px;">
          <i class="fas ${icon}" style="font-size: 20px; color: ${color};"></i>
          <div style="flex: 1;">
            <div style="font-weight: 600; margin-bottom: 4px; color: ${color};">${type.toUpperCase()}</div>
            <div style="font-size: 13px; color: rgba(255,255,255,0.8);">${message}</div>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideInRight 0.3s ease reverse';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 4000);
    }
    
    function showNotification(type, message) {
      showEliteNotification(type, message);
    }
    
    function showError(elementId, message) {
      const element = document.getElementById(elementId);
      if (!element) return;
      element.textContent = message;
      element.style.display = 'block';
      setTimeout(() => {
        element.style.display = 'none';
      }, 5000);
    }
    
    function showSuccess(elementId, message) {
      const element = document.getElementById(elementId);
      if (!element) return;
      element.textContent = message;
      element.style.display = 'block';
      setTimeout(() => {
        element.style.display = 'none';
      }, 5000);
    }
    
    function toggleLoading(buttonId, isLoading, text = '') {
      const btn = document.getElementById(buttonId);
      if (!btn) return;
      
      if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = `<span class="loading"></span>`;
      } else {
        btn.disabled = false;
        btn.innerHTML = text;
      }
    }
    
    function initParticles() {
      const container = document.getElementById('particles');
      if (!container) return;
      
      const particleCount = 50;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'floating-particle';
        
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 100}vh`;
        
        const size = Math.random() * 4 + 1;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        particle.style.opacity = Math.random() * 0.5 + 0.2;
        particle.style.animationDelay = `${Math.random() * 20}s`;
        particle.style.animationDuration = `${Math.random() * 15 + 15}s`;
        
        container.appendChild(particle);
      }
    }
    
    // ========== AUTH FUNCTIONS ==========
    function showRegister() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'block';
    }
    
    function showLogin() {
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }
    
    function generateReferralCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = '';
      for (let i = 0; i < 6; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }
    
    async function processReferral(referralCode, referredUserId) {
      try {
        console.log('ðŸ” Processing referral:', { referralCode, referredUserId });
        
        if (!referralCode || typeof referralCode !== 'string') {
          console.warn('âŒ Invalid referral code format');
          return false;
        }
        
        const refCode = referralCode.trim().toUpperCase();
        
        const usersRef = db.collection('users');
        const querySnapshot = await usersRef.where('referralCode', '==', refCode).get();
        
        if (querySnapshot.empty) {
          console.log('âš ï¸ Referral code not found');
          return false;
        }
        
        const referrerDoc = querySnapshot.docs[0];
        const referrerId = referrerDoc.id;
        
        if (referrerId === referredUserId) {
          console.log('âš ï¸ Self-referral not allowed');
          return false;
        }
        
        const referralCheck = await db.collection('referrals')
          .where('referredId', '==', referredUserId)
          .where('referrerCode', '==', refCode)
          .get();
        
        if (!referralCheck.empty) {
          console.log('âš ï¸ Referral already processed');
          return false;
        }
        
        await db.collection('users').doc(referrerId).update({
          balance: firebase.firestore.FieldValue.increment(350),
          referralCount: firebase.firestore.FieldValue.increment(1),
          todayReward: firebase.firestore.FieldValue.increment(350)
        });
        
        await db.collection('users').doc(referredUserId).update({
          balance: firebase.firestore.FieldValue.increment(150),
          hasUsedReferral: true
        });
        
        await db.collection('referrals').add({
          referrerId: referrerId,
          referredId: referredUserId,
          referrerCode: refCode,
          referrerBonus: 350,
          referredBonus: 150,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          status: 'success'
        });
        
        console.log('âœ… Referral processed successfully');
        return true;
        
      } catch (error) {
        console.error('âŒ Error processing referral:', error);
        return false;
      }
    }
    
    async function login() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const referral = document.getElementById('referralCode').value.trim();
      
      if (!email || !password) {
        showError('loginError', 'Email dan password harus diisi');
        return;
      }
      
      toggleLoading('loginBtn', true);
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        
        if (userDoc.exists) {
          userData = userDoc.data();
          
          await new Promise(resolve => setTimeout(resolve, 500));
          
          if (referral && userData && !userData.hasUsedReferral) {
            console.log('ðŸ” Processing referral on login:', referral);
            const success = await processReferral(referral, currentUser.uid);
            if (success) {
              await db.collection('users').doc(currentUser.uid).update({
                hasUsedReferral: true
              });
            }
          }
        } else {
          const newReferralCode = generateReferralCode();
          
          let initialBalance = 0;
          if (referral) {
            const success = await processReferral(referral, currentUser.uid);
            if (success) {
              initialBalance = 150;
            }
          }
          
          userData = {
            email: email,
            role: 'user',
            referralCode: newReferralCode,
            balance: initialBalance,
            referralCount: 0,
            failedReferrals: 0,
            todayReward: 0,
            totalWithdraw: 0,
            hasUsedReferral: !!referral,
            status: 'active',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          await db.collection('users').doc(currentUser.uid).set(userData);
        }
        
        showApp();
        showNotification('success', 'Login berhasil! Welcome to Elite! ðŸŽ‰');
        
      } catch (error) {
        console.error('âŒ Login error:', error);
        let errorMsg = 'Login gagal';
        if (error.code === 'auth/user-not-found') errorMsg = 'Email tidak terdaftar';
        if (error.code === 'auth/wrong-password') errorMsg = 'Password salah';
        if (error.code === 'auth/invalid-email') errorMsg = 'Email tidak valid';
        
        showError('loginError', errorMsg);
        toggleLoading('loginBtn', false, '<i class="fas fa-lock-open"></i> ACCESS PREMIUM');
      }
    }
    
    async function register() {
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPass = document.getElementById('registerConfirm').value;
      const referral = document.getElementById('registerReferral').value.trim();
      
      if (!email || !password || !confirmPass) {
        showError('registerError', 'Semua field wajib diisi');
        return;
      }
      
      if (password.length < 6) {
        showError('registerError', 'Password minimal 6 karakter');
        return;
      }
      
      if (password !== confirmPass) {
        showError('registerError', 'Password tidak cocok');
        return;
      }
      
      toggleLoading('registerBtn', true);
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        
        const newReferralCode = generateReferralCode();
        
        userData = {
          email: email,
          role: 'user',
          referralCode: newReferralCode,
          balance: 0,
          referralCount: 0,
          failedReferrals: 0,
          todayReward: 0,
          totalWithdraw: 0,
          hasUsedReferral: false,
          status: 'active',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await db.collection('users').doc(currentUser.uid).set(userData);
        
        if (referral) {
          await processReferral(referral, currentUser.uid);
          await db.collection('users').doc(currentUser.uid).update({
            hasUsedReferral: true
          });
        }
        
        showApp();
        showNotification('success', 'Pendaftaran berhasil! Welcome to the Elite Club! ðŸš€');
        
      } catch (error) {
        console.error('âŒ Register error:', error);
        let errorMsg = 'Pendaftaran gagal';
        if (error.code === 'auth/email-already-in-use') errorMsg = 'Email sudah terdaftar';
        if (error.code === 'auth/invalid-email') errorMsg = 'Email tidak valid';
        if (error.code === 'auth/weak-password') errorMsg = 'Password terlalu lemah';
        
        showError('registerError', errorMsg);
        toggleLoading('registerBtn', false, '<i class="fas fa-user-plus"></i> JOIN ELITE');
      }
    }
    
    // ========== MAIN APP FUNCTIONS ==========
    function showApp() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      
      const username = currentUser.email.split('@')[0];
      document.getElementById('welcomeText').textContent = `WELCOME, ${username.toUpperCase()}!`;
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
      document.getElementById('userRole').textContent = 'ELITE MEMBER';
      
      loadUserData();
      setupRealTimeListener();
      checkUrlForReferral();
    }
    
    function showAppPage(pageId) {
      document.querySelectorAll('.glass-card').forEach(card => {
        if (card.closest('#appContainer')) {
          card.style.display = 'none';
        }
      });
      
      document.getElementById(pageId).style.display = 'block';
      
      document.querySelectorAll('.nav-item-elite').forEach(nav => {
        nav.classList.remove('active');
      });
      
      const navItems = document.querySelectorAll('.nav-item-elite');
      if (pageId === 'homePage') {
        navItems[0].classList.add('active');
        loadUserData();
      }
      else if (pageId === 'referralPage') {
        navItems[1].classList.add('active');
        loadReferralData();
      }
      else if (pageId === 'withdrawalPage') {
        navItems[2].classList.add('active');
        loadWithdrawalData();
      }
      else if (pageId === 'profilePage') {
        navItems[3].classList.add('active');
        loadProfileData();
      }
    }
    
    async function loadUserData() {
      if (!currentUser) return;
      
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
          userData = userDoc.data();
          userBalance = userData.balance || 0;
          referralCount = userData.referralCount || 0;
          failedReferrals = userData.failedReferrals || 0;
          todayReward = userData.todayReward || 0;
          userReferralCode = userData.referralCode || '';
          
          updateUI();
        }
      } catch (error) {
        console.error('âŒ Error loading user data:', error);
      }
    }
    
    function updateUI() {
      document.getElementById('userBalance').textContent = formatRupiah(userBalance);
      document.getElementById('successReferrals').textContent = referralCount;
      document.getElementById('failedReferrals').textContent = failedReferrals;
      document.getElementById('todayReward').textContent = formatRupiah(todayReward);
      document.getElementById('withdrawalBalance').textContent = formatRupiah(userBalance);
      
      document.getElementById('profileReferralCount').textContent = referralCount;
      document.getElementById('profileFailedReferrals').textContent = failedReferrals;
      document.getElementById('profileTotalEarnings').textContent = formatRupiah(referralCount * 350);
      document.getElementById('profileBalance').textContent = formatRupiah(userBalance);
    }
    
    function setupRealTimeListener() {
      if (!currentUser) return;
      
      if (realTimeListener) {
        realTimeListener();
      }
      
      realTimeListener = db.collection('users').doc(currentUser.uid)
        .onSnapshot((doc) => {
          if (doc.exists) {
            const newData = doc.data();
            const oldBalance = userBalance;
            
            userBalance = newData.balance || 0;
            referralCount = newData.referralCount || 0;
            failedReferrals = newData.failedReferrals || 0;
            todayReward = newData.todayReward || 0;
            userReferralCode = newData.referralCode || '';
            
            if (userBalance !== oldBalance) {
              updateUI();
            }
          }
        }, (error) => {
          console.error('âŒ Real-time listener error:', error);
        });
    }
    
    // ========== REFERRAL FUNCTIONS ==========
    async function loadReferralData() {
      if (!currentUser) return;
      
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
          const data = userDoc.data();
          
          document.getElementById('userReferralCode').textContent = data.referralCode || 'GENERATE...';
          document.getElementById('totalReferralsPage').textContent = data.referralCount || 0;
          document.getElementById('failedReferralsPage').textContent = data.failedReferrals || 0;
        }
      } catch (error) {
        console.error('âŒ Error loading referral data:', error);
      }
    }
    
    function copyReferralCode() {
      if (!userReferralCode) {
        showNotification('error', 'Kode referral belum siap');
        return;
      }
      
      navigator.clipboard.writeText(userReferralCode).then(() => {
        const codeElement = document.getElementById('userReferralCode');
        const originalText = codeElement.textContent;
        
        codeElement.textContent = 'âœ… COPIED!';
        codeElement.style.color = '#00FF7F';
        codeElement.style.borderImage = 'linear-gradient(45deg, #00FF7F, #00CC66) 1';
        
        showNotification('success', 'Kode referral berhasil disalin! ðŸŽ¯');
        
        setTimeout(() => {
          codeElement.textContent = originalText;
          codeElement.style.color = '#FFD700';
          codeElement.style.borderImage = 'linear-gradient(45deg, #8A2BE2, #4B0082) 1';
        }, 2000);
      }).catch(err => {
        showNotification('error', 'Gagal menyalin kode');
      });
    }
    
    function shareReferral() {
      if (!userReferralCode) {
        showNotification('error', 'Kode referral belum tersedia');
        return;
      }
      
      const shareLink = `${window.location.origin}${window.location.pathname}?ref=${userReferralCode}`;
      document.getElementById('shareableLink').textContent = shareLink;
      document.getElementById('shareModal').style.display = 'flex';
    }
    
    function closeModal() {
      document.getElementById('shareModal').style.display = 'none';
    }
    
    function copyShareLink() {
      const link = document.getElementById('shareableLink').textContent;
      navigator.clipboard.writeText(link).then(() => {
        showNotification('success', 'Link berhasil dicopy! ðŸ“‹');
        closeModal();
      }).catch(err => {
        showNotification('error', 'Gagal copy link');
      });
    }
    
    // ========== WITHDRAWAL FUNCTIONS ==========
    function selectWallet(walletType) {
      selectedWallet = walletType;
      
      document.getElementById('danaForm')?.style.display = 'none';
      document.getElementById('ovoForm')?.style.display = 'none';
      document.getElementById('shopeeForm')?.style.display = 'none';
      document.getElementById('bankForm')?.style.display = 'none';
      
      document.getElementById('walletDana')?.classList.remove('active');
      document.getElementById('walletOvo')?.classList.remove('active');
      document.getElementById('walletShopee')?.classList.remove('active');
      document.getElementById('walletBank')?.classList.remove('active');
      
      const walletElement = document.getElementById(`wallet${walletType.charAt(0).toUpperCase() + walletType.slice(1)}`);
      if (walletElement) {
        walletElement.classList.add('active');
      }
      
      if (walletType === 'dana') {
        document.getElementById('danaForm')?.style.display = 'block';
      } else if (walletType === 'ovo') {
        document.getElementById('ovoForm')?.style.display = 'block';
      } else if (walletType === 'shopee') {
        document.getElementById('shopeeForm')?.style.display = 'block';
      } else if (walletType === 'bank') {
        document.getElementById('bankForm')?.style.display = 'block';
      }
    }
    
    async function submitWithdrawal() {
      if (!currentUser) {
        showError('withdrawalError', 'Silakan login terlebih dahulu');
        return;
      }
      
      if (!selectedWallet) {
        showError('withdrawalError', 'Pilih metode penarikan terlebih dahulu');
        return;
      }
      
      const amountInput = document.getElementById('withdrawalAmount')?.value.trim();
      
      if (!amountInput) {
        showError('withdrawalError', 'Masukkan jumlah penarikan');
        return;
      }
      
      const amount = parseInt(amountInput.replace(/[^\d]/g, ''));
      
      if (isNaN(amount) || amount < 10000) {
        showError('withdrawalError', 'Minimal penarikan Rp10.000');
        return;
      }
      
      if (amount > userBalance) {
        showError('withdrawalError', 'Saldo tidak mencukupi');
        return;
      }
      
      let accountInfo = '';
      let accountName = '';
      
      if (selectedWallet === 'dana') {
        const danaNumber = document.getElementById('danaNumber')?.value.trim();
        const danaName = document.getElementById('danaName')?.value.trim();
        
        if (!danaNumber || !danaName) {
          showError('withdrawalError', 'Isi semua data DANA');
          return;
        }
        
        accountInfo = `DANA: ${danaNumber}`;
        accountName = danaName;
      } 
      else if (selectedWallet === 'ovo') {
        const ovoNumber = document.getElementById('ovoNumber')?.value.trim();
        const ovoName = document.getElementById('ovoName')?.value.trim();
        
        if (!ovoNumber || !ovoName) {
          showError('withdrawalError', 'Isi semua data OVO');
          return;
        }
        
        accountInfo = `OVO: ${ovoNumber}`;
        accountName = ovoName;
      }
      else if (selectedWallet === 'shopee') {
        const shopeeNumber = document.getElementById('shopeeNumber')?.value.trim();
        const shopeeName = document.getElementById('shopeeName')?.value.trim();
        
        if (!shopeeNumber || !shopeeName) {
          showError('withdrawalError', 'Isi semua data ShopeePay');
          return;
        }
        
        accountInfo = `ShopeePay: ${shopeeNumber}`;
        accountName = shopeeName;
      }
      else if (selectedWallet === 'bank') {
        const bankName = document.getElementById('bankName')?.value;
        const bankNumber = document.getElementById('bankNumber')?.value.trim();
        const bankAccountName = document.getElementById('bankAccountName')?.value.trim();
        
        if (!bankName || !bankNumber || !bankAccountName) {
          showError('withdrawalError', 'Isi semua data bank');
          return;
        }
        
        accountInfo = `${bankName}: ${bankNumber}`;
        accountName = bankAccountName;
      }
      
      if (!confirm(`ðŸ’° CONFIRM WITHDRAWAL\n\nAmount: Rp${amount.toLocaleString('id-ID')}\nMethod: ${selectedWallet.toUpperCase()}\nAccount: ${accountInfo}\nName: ${accountName}\n\nProceed?`)) {
        return;
      }
      
      const btn = document.getElementById('withdrawalBtn');
      const originalHTML = btn?.innerHTML || '';
      if (btn) {
        btn.innerHTML = '<span class="loading"></span>';
        btn.disabled = true;
      }
      
      try {
        await db.collection('withdrawals').add({
          userId: currentUser.uid,
          userEmail: currentUser.email,
          amount: amount,
          method: selectedWallet.toUpperCase(),
          accountInfo: accountInfo,
          accountName: accountName,
          status: 'pending',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        await db.collection('users').doc(currentUser.uid).update({
          balance: firebase.firestore.FieldValue.increment(-amount),
          totalWithdraw: firebase.firestore.FieldValue.increment(amount),
          lastWithdrawal: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        userBalance -= amount;
        
        document.getElementById('withdrawalAmount')?.value = '';
        
        selectedWallet = null;
        document.querySelectorAll('.wallet-option-elite').forEach(el => {
          el.classList.remove('active');
        });
        
        updateUI();
        
        const successHtml = `
          <div style="text-align: left;">
            <div style="color: #00FF7F; font-weight: bold; margin-bottom: 10px;">
              âœ… WITHDRAWAL REQUEST SUBMITTED!
            </div>
            <div style="font-size: 12px; line-height: 1.5;">
              <div>ðŸ’° <strong>Amount:</strong> Rp${amount.toLocaleString('id-ID')}</div>
              <div>ðŸ“± <strong>Method:</strong> ${selectedWallet?.toUpperCase() || ''}</div>
              <div>ðŸ¦ <strong>Account:</strong> ${accountInfo}</div>
              <div>ðŸ‘¤ <strong>Name:</strong> ${accountName}</div>
              <div>â° <strong>Status:</strong> <span style="color: #FFD700;">PENDING</span></div>
              <div style="margin-top: 10px; color: #FFD700;">
                <i class="fas fa-clock"></i> Processed within 24 hours
              </div>
            </div>
          </div>
        `;
        
        const successEl = document.getElementById('withdrawalSuccess');
        if (successEl) {
          successEl.innerHTML = successHtml;
          successEl.style.display = 'block';
          setTimeout(() => {
            successEl.style.display = 'none';
          }, 10000);
        }
        
        setTimeout(() => {
          loadWithdrawalData();
        }, 1000);
        
        showNotification('success', 
          `Withdrawal Rp${amount.toLocaleString('id-ID')} submitted successfully! ðŸŽ‰`
        );
        
      } catch (error) {
        console.error('âŒ Withdrawal error:', error);
        showError('withdrawalError', 'Gagal mengajukan penarikan: ' + error.message);
      } finally {
        if (btn) {
          btn.innerHTML = originalHTML;
          btn.disabled = false;
        }
      }
    }
    
    async function loadWithdrawalData() {
      if (!currentUser) return;
      
      try {
        const withdrawalsRef = db.collection('withdrawals')
          .where('userId', '==', currentUser.uid)
          .orderBy('timestamp', 'desc')
          .limit(20);
        
        const snapshot = await withdrawalsRef.get();
        const historyContainer = document.getElementById('withdrawalHistory');
        
        if (snapshot.empty) {
          historyContainer.innerHTML = `
            <div style="text-align: center; color: var(--text-muted); padding: 40px;">
              <i class="fas fa-receipt fa-3x" style="margin-bottom: 15px; opacity: 0.5;"></i><br>
              No withdrawal history yet
            </div>
          `;
          return;
        }
        
        let html = '';
        snapshot.forEach(doc => {
          const wdData = doc.data();
          const date = wdData.timestamp?.toDate() || new Date();
          const formattedDate = date.toLocaleDateString('id-ID');
          const formattedTime = date.toLocaleTimeString('id-ID', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          
          let statusClass = 'status-pending';
          let statusText = 'PENDING';
          let statusType = 'pending';
          let borderColor = '#f59e0b';
          
          if (wdData.status === 'approved') {
            statusClass = 'status-approved';
            statusText = 'SUCCESS';
            statusType = 'success';
            borderColor = '#00FF7F';
          } else if (wdData.status === 'rejected') {
            statusClass = 'status-rejected';
            statusText = 'REJECTED';
            statusType = 'rejected';
            borderColor = '#FF416C';
          } else if (wdData.status === 'processing') {
            statusClass = 'status-processing';
            statusText = 'PROCESSING';
            statusType = 'processing';
            borderColor = '#00D4FF';
          }
          
          html += `
            <div class="history-item-elite" style="border-left-color: ${borderColor};">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="font-weight: 800; color: #FFD700; font-size: 18px;">
                  Rp${(wdData.amount || 0).toLocaleString('id-ID')}
                </div>
                <div style="font-size: 11px; padding: 6px 12px; border-radius: 20px; background: ${borderColor}20; color: ${borderColor}; font-weight: 600;">
                  ${statusText}
                </div>
              </div>
              <div style="font-size: 12px; color: var(--text-muted);">
                <div style="margin-bottom: 5px;">
                  <strong>${wdData.method || 'Unknown'}</strong> â€¢ ${wdData.accountInfo || ''}
                </div>
                <div style="font-size: 11px;">
                  ðŸ‘¤ ${wdData.accountName || ''}<br>
                  ðŸ“… ${formattedDate} â° ${formattedTime}
                </div>
              </div>
            </div>
          `;
        });
        
        historyContainer.innerHTML = html;
        
      } catch (error) {
        console.error('âŒ Error loading withdrawal data:', error);
        const historyContainer = document.getElementById('withdrawalHistory');
        historyContainer.innerHTML = `
          <div style="text-align: center; color: #FF416C; padding: 30px;">
            <i class="fas fa-exclamation-triangle fa-2x"></i><br>
            Error loading data
          </div>
        `;
      }
    }
    
    // ========== PROFILE FUNCTIONS ==========
    async function loadProfileData() {
      if (!currentUser) return;
      
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        
        if (userDoc.exists) {
          const data = userDoc.data();
          
          document.getElementById('profileEmail').textContent = currentUser.email;
          document.getElementById('profileUserId').textContent = currentUser.uid;
          document.getElementById('profileRole').textContent = data.role || 'ELITE';
        }
      } catch (error) {
        console.error('âŒ Error loading profile data:', error);
      }
    }
    
    function copyToClipboard(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        showNotification('success', 'User ID copied successfully! ðŸ“‹');
      }).catch(err => {
        showNotification('error', 'Failed to copy');
      });
    }
    
    function showChangePasswordModal() {
      document.getElementById('changePasswordModal').style.display = 'flex';
    }
    
    function closeChangePasswordModal() {
      document.getElementById('changePasswordModal').style.display = 'none';
      document.getElementById('oldPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmNewPassword').value = '';
      document.getElementById('changePasswordError').style.display = 'none';
      document.getElementById('changePasswordSuccess').style.display = 'none';
    }
    
    async function changePassword() {
      const oldPassword = document.getElementById('oldPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmNewPassword').value;
      
      if (!oldPassword || !newPassword || !confirmPassword) {
        showError('changePasswordError', 'Semua field wajib diisi');
        return;
      }
      
      if (newPassword.length < 6) {
        showError('changePasswordError', 'Password baru minimal 6 karakter');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showError('changePasswordError', 'Password baru tidak cocok');
        return;
      }
      
      const btn = document.getElementById('changePasswordBtn');
      const originalText = btn?.innerHTML || '';
      if (btn) {
        btn.innerHTML = '<span class="loading"></span>';
        btn.disabled = true;
      }
      
      try {
        const credential = firebase.auth.EmailAuthProvider.credential(
          currentUser.email, 
          oldPassword
        );
        await currentUser.reauthenticateWithCredential(credential);
        
        await currentUser.updatePassword(newPassword);
        
        showSuccess('changePasswordSuccess', 'Password berhasil diubah! ðŸ”');
        
        setTimeout(() => {
          closeChangePasswordModal();
        }, 2000);
        
      } catch (error) {
        console.error('âŒ Change password error:', error);
        let errorMsg = 'Gagal mengubah password';
        if (error.code === 'auth/wrong-password') errorMsg = 'Password lama salah';
        if (error.code === 'auth/weak-password') errorMsg = 'Password terlalu lemah';
        
        showError('changePasswordError', errorMsg);
      } finally {
        if (btn) {
          btn.innerHTML = originalText;
          btn.disabled = false;
        }
      }
    }
    
    function confirmLogout() {
      if (confirm('Are you sure you want to logout from your Elite account?')) {
        logout();
      }
    }
    
    async function logout() {
      try {
        if (realTimeListener) {
          realTimeListener();
          realTimeListener = null;
        }
        
        await auth.signOut();
        
        currentUser = null;
        userData = {};
        
        window.location.reload();
      } catch (error) {
        console.error('âŒ Error logging out:', error);
        showNotification('error', 'Logout failed');
      }
    }
    
    // ========== URL REFERRAL CHECK ==========
    function checkUrlForReferral() {
      const urlParams = new URLSearchParams(window.location.search);
      const refCode = urlParams.get('ref');
      
      if (refCode && currentUser) {
        processUrlReferral(refCode);
        
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }
    
    async function processUrlReferral(refCode) {
      if (!currentUser || !refCode) return;
      
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
          const data = userDoc.data();
          
          if (!data.hasUsedReferral) {
            const success = await processReferral(refCode.toUpperCase(), currentUser.uid);
            
            if (success) {
              await db.collection('users').doc(currentUser.uid).update({
                hasUsedReferral: true
              });
              
              showNotification('success', 'Referral bonus applied! ðŸŽ');
            }
          }
        }
      } catch (error) {
        console.error('âŒ Error processing URL referral:', error);
      }
    }
    
    // ========== AUTH STATE LISTENER ==========
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        
        try {
          const userDoc = await db.collection('users').doc(user.uid).get();
          if (userDoc.exists) {
            userData = userDoc.data();
            showApp();
          } else {
            const newReferralCode = generateReferralCode();
            
            await db.collection('users').doc(user.uid).set({
              email: user.email,
              role: 'user',
              referralCode: newReferralCode,
              balance: 0,
              referralCount: 0,
              failedReferrals: 0,
              todayReward: 0,
              totalWithdraw: 0,
              hasUsedReferral: false,
              status: 'active',
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            userData = { 
              email: user.email, 
              role: 'user',
              referralCode: newReferralCode,
              balance: 0,
              referralCount: 0
            };
            showApp();
          }
        } catch (error) {
          console.error('âŒ Error in auth state change:', error);
        }
      }
    });
    
    // ========== INITIALIZE ==========
    document.addEventListener('DOMContentLoaded', function() {
      initParticles();
      console.log('ðŸš€ ELITE REFERRAL UI Loaded - Premium Experience Activated');
      
      document.addEventListener('mousemove', function(e) {
        const cards = document.querySelectorAll('.glass-card');
        cards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          card.style.setProperty('--mouse-x', `${x}px`);
          card.style.setProperty('--mouse-y', `${y}px`);
        });
      });
      
      showNotification('info', 'Welcome to Elite Referral! Maximize your earnings! ðŸ’Ž');
    });
  </script>
</body>
</html>