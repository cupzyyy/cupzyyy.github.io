<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ZYY AI — Chat</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
  <style>
    :root{--primary:#6366f1;--bg:#fafafa;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:"Poppins",sans-serif;margin:0;background:var(--bg);color:#111827;display:flex;flex-direction:column;min-height:100vh}
    header{padding:14px 18px;background:#fff;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
    .container{max-width:900px;margin:22px auto;padding:0 18px;flex:1;display:flex;flex-direction:column;gap:18px}
    .chat{background:#fff;border-radius:12px;padding:14px;border:1px solid #eef2ff;display:flex;flex-direction:column;height:60vh;overflow:hidden}
    .messages{flex:1;overflow:auto;display:flex;flex-direction:column;gap:12px;padding-right:8px}
    .msg{max-width:80%;padding:10px 12px;border-radius:12px}
    .msg.ai{background:#fff;border:1px solid #eee;align-self:flex-start}
    .msg.user{background:linear-gradient(90deg,#6366f1,#8b5cf6);color:#fff;align-self:flex-end}
    .input-row{display:flex;gap:8px}
    input#user{flex:1;padding:12px;border-radius:999px;border:1px solid #e6eefb;outline:none}
    button#send{background:var(--primary);color:#fff;border:none;padding:0 14px;border-radius:10px;cursor:pointer}
    .small{color:var(--muted);font-size:0.9rem}
    a.back{color:var(--primary);text-decoration:none}
    @media (max-width:480px){.chat{height:55vh}}
  </style>
</head>
<body>
  <header>
    <div><strong>ZYY AI</strong><div class="small">Gemini 2.5 Flash — Demo UI</div></div>
    <div><a class="back" href="/">Beranda</a></div>
  </header>

  <main class="container">
    <div class="chat" id="chat">
      <div class="messages" id="msgs">
        <div class="msg ai"><strong>ZYY AI</strong><div class="small">Halo! Saya ZYY AI. Tanyakan apa saja.</div></div>
      </div>

      <div>
        <div class="input-row">
          <input id="user" placeholder="Ketik pesan..." autocomplete="off" />
          <button id="send"><i class="fas fa-paper-plane"></i></button>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="clear" style="padding:6px 10px;border-radius:8px;border:1px solid #eee;background:#fff;cursor:pointer">Hapus</button>
          <span class="small" id="note">Note: API key tidak boleh langsung di client.</span>
        </div>
      </div>
    </div>
  </main>

  <footer style="padding:12px;text-align:center;color:#9ca3af">
    © <span id="yr"></span> ZYY AI — Demo. Gunakan proxy server untuk API.
    <script>document.getElementById('yr').textContent=new Date().getFullYear();</script>
  </footer>

  <script>
    // ====== IMPORTANT ======
    // DO NOT put your real API KEY here. Instead create a server/proxy endpoint that stores the key securely.
    // Example: POST /api/gemini with JSON { prompt: "..."}
    // The server will add the API key and call Gemini/OpenAI, then return the response.
    //
    // For testing only you can set a placeholder endpoint variable:
    const PROXY_ENDPOINT = '/api/gemini'; // <-- replace with your serverless function URL

    const msgs = document.getElementById('msgs');
    const input = document.getElementById('user');
    const sendBtn = document.getElementById('send');
    const clearBtn = document.getElementById('clear');

    function appendMessage(text, isUser=false){
      const d = document.createElement('div');
      d.className = 'msg ' + (isUser ? 'user' : 'ai');
      d.innerHTML = (isUser ? '<strong>Anda</strong><div>' : '<strong>ZYY AI</strong><div>') + text + '</div>';
      msgs.appendChild(d);
      msgs.scrollTop = msgs.scrollHeight;
    }

    async function callProxy(prompt){
      // Example request to your proxy. Proxy should handle the real API key and call Gemini.
      try {
        const res = await fetch(PROXY_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({prompt})
        });
        if(!res.ok){
          const t = await res.text();
          throw new Error('Server error: ' + res.status + ' ' + t);
        }
        const j = await res.json();
        // Expect proxy returns { text: "response text" }
        return j.text || 'Maaf, tidak ada respons.';
      } catch (err) {
        console.error(err);
        return 'Terjadi kesalahan: ' + err.message;
      }
    }

    async function sendMessage(){
      const text = input.value.trim();
      if(!text) return;
      appendMessage(text, true);
      input.value = '';
      appendMessage('Mengetik...', false);
      const ai = await callProxy(text);
      // remove last "Mengetik..." message
      const last = msgs.querySelectorAll('.msg.ai');
      if(last && last.length) last[last.length-1].remove();
      appendMessage(ai, false);
    }

    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keydown', e => { if(e.key === 'Enter') sendMessage(); });
    clearBtn.addEventListener('click', () => { msgs.innerHTML = '<div class="msg ai"><strong>ZYY AI</strong><div class="small">Halo! Saya ZYY AI. Tanyakan apa saja.</div></div>'; });

  </script>
</body>
</html>
